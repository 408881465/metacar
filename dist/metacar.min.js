window["metacar"] =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/asset_manager.ts":
/*!******************************!*\
  !*** ./src/asset_manager.ts ***!
  \******************************/
/*! exports provided: AssetManger */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AssetManger\", function() { return AssetManger; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./global */ \"./src/global.ts\");\n/* harmony import */ var _car__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./car */ \"./src/car.ts\");\n/* harmony import */ var _basic_motion_engine__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./basic_motion_engine */ \"./src/basic_motion_engine.ts\");\n/* harmony import */ var _control_motion_engine__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./control_motion_engine */ \"./src/control_motion_engine.ts\");\n/* harmony import */ var _bot_motion_engine__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./bot_motion_engine */ \"./src/bot_motion_engine.ts\");\n\n\n\n\n\n\n;\nvar AssetManger = (function () {\n    function AssetManger(level) {\n        this.assets = [];\n        this.level = level;\n        this.motion = {\n            \"BasicMotionEngine\": _basic_motion_engine__WEBPACK_IMPORTED_MODULE_3__[\"BasicMotionEngine\"],\n            \"ControlMotionEngine\": _control_motion_engine__WEBPACK_IMPORTED_MODULE_4__[\"ControlMotionEngine\"]\n        };\n    }\n    AssetManger.prototype.createRoadSide = function (info, textures) {\n        var x = (info.mx) * _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"];\n        var y = (info.my) * _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"];\n        var area = new _global__WEBPACK_IMPORTED_MODULE_1__[\"Graphics\"]();\n        area.beginFill(0xe8e8e8);\n        area.drawRoundedRect(0, 0, _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] + 30, _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] + 30, undefined);\n        area.x = x - 15;\n        area.y = y - 15;\n        area.endFill();\n        this.level.addChild(area);\n    };\n    AssetManger.prototype.createRoad = function (info, textures) {\n        var _this = this;\n        var road = new _global__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](textures[_global__WEBPACK_IMPORTED_MODULE_1__[\"ASSETS\"].ROADS[info.type].image]);\n        road.x = (info.mx) * _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"];\n        road.y = (info.my) * _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"];\n        road.obstacle = false;\n        road.mapId = _global__WEBPACK_IMPORTED_MODULE_1__[\"MAP\"].ROAD;\n        road.orientation = _global__WEBPACK_IMPORTED_MODULE_1__[\"ASSETS\"].ROADS[info.type].orientation;\n        road.setCarPosition = function (car, line) { return _this.setCarOnRoad(road, car, line); };\n        road.cars = [];\n        road.mx = info.mx;\n        road.my = info.my;\n        this.level.addRoad(road);\n    };\n    AssetManger.prototype.setCarOnRoad = function (road, car, line) {\n        if (line == undefined)\n            line = 0;\n        var carById = this.level.findCarById(road.cars[0]);\n        if (road.cars.length >= 1 && carById && carById.core.line == line) {\n            line = line == 0 ? 1 : 0;\n        }\n        if (road.cars.length >= 2) {\n            car.is_valid = false;\n            return;\n        }\n        car.line = line;\n        car.x = road.x;\n        car.y = road.y;\n        car.x += _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2;\n        car.y += _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2;\n        var x_margin = 0;\n        var y_margin = (_global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] * 1 / 4);\n        road.orientation = (Math.floor(road.orientation / car.rotationStep) * car.rotationStep);\n        var th = -road.orientation * (Math.PI);\n        var x_m = (Math.cos(th) * x_margin) - (y_margin * Math.sin(th));\n        var y_m = (Math.cos(th) * y_margin) + (x_margin * Math.sin(th));\n        var line_side_factor = line == 0 ? 1 : -1;\n        var line_side_factor_t = line == 0 ? 0 : Math.PI;\n        car.x += line_side_factor * Math.round(x_m);\n        car.y += line_side_factor * Math.round(y_m);\n        car.mx = Math.floor(car.x / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        car.my = Math.floor(car.y / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        car.rotation = (th + line_side_factor_t);\n        car.checkAndsetNewRoad(road);\n    };\n    AssetManger.prototype.createAsset = function (img, info, textures, type) {\n        var asset = new _global__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](textures[img]);\n        asset.obstacle = false;\n        asset.type = type;\n        asset.mapId = 0;\n        asset.x = info.x;\n        asset.y = info.y;\n        this.level.addChild(asset);\n        this.assets.push(asset);\n    };\n    AssetManger.prototype.createMap = function (map, info, textures, roadside) {\n        if (roadside === void 0) { roadside = true; }\n        if (roadside) {\n            for (var my = 0; my < map.length; my++) {\n                for (var mx = 0; mx < map[my].length; mx++) {\n                    if (_global__WEBPACK_IMPORTED_MODULE_1__[\"ASSETS\"].ROADS[map[my][mx]]) {\n                        this.createRoadSide({ mx: mx, my: my, type: map[my][mx] }, textures);\n                    }\n                }\n            }\n        }\n        for (var my = 0; my < map.length; my++) {\n            for (var mx = 0; mx < map[my].length; mx++) {\n                if (_global__WEBPACK_IMPORTED_MODULE_1__[\"ASSETS\"].ROADS[map[my][mx]]) {\n                    this.createRoad({ mx: mx, my: my, type: map[my][mx] }, textures);\n                }\n            }\n        }\n        for (var key in _global__WEBPACK_IMPORTED_MODULE_1__[\"ASSETS\"]) {\n            if (key != \"ROADS\" && info[key]) {\n                for (var a = 0; a < info[key].length; a++) {\n                    this.createAsset(_global__WEBPACK_IMPORTED_MODULE_1__[\"ASSETS\"][key].image, info[key][a], textures, key);\n                }\n            }\n        }\n    };\n    AssetManger.prototype.createCars = function (map, info, textures) {\n        for (var c in info.cars) {\n            var options = { lidar: true, lidarInfo: { pts: 2, width: 0.5, height: 1, pos: 1 } };\n            if (info.cars[c].auto) {\n                options.lidar = true;\n                options.motionEngine = new _bot_motion_engine__WEBPACK_IMPORTED_MODULE_5__[\"BotMotionEngine\"](this.level);\n            }\n            var n_car = new _car__WEBPACK_IMPORTED_MODULE_2__[\"Car\"](this.level, info.cars[c], textures, options);\n            this.level.addCar(n_car);\n        }\n    };\n    AssetManger.prototype.createAgent = function (map, info, textures) {\n        var agent = new _car__WEBPACK_IMPORTED_MODULE_2__[\"Car\"](this.level, info.agent, textures, {\n            image: _global__WEBPACK_IMPORTED_MODULE_1__[\"CAR_IMG\"].AGENT,\n            lidar: true,\n            motionEngine: new this.motion[info.agent.motion.type](this.level, info.agent.motion.options)\n        });\n        this.level.addChild(agent.lidar);\n        this.level.addCar(agent);\n        agent.core.agent = true;\n        return agent;\n    };\n    AssetManger.prototype.addAsset = function (asset) {\n        this.assets.push(asset);\n    };\n    AssetManger.prototype.exportMap = function (width, height, file_name) {\n        var file = { \"cars\": [] };\n        var map = [];\n        var envs = this.level.getEnvs();\n        for (var y = 0; y < height; y++) {\n            var line = [];\n            for (var x = 0; x < width; x++) {\n                line.push(0);\n            }\n            map.push(line);\n        }\n        for (var e = 0; e < envs.length; e++) {\n            var elem = envs[e];\n            if (!elem.isremove) {\n                if (elem.mapId == _global__WEBPACK_IMPORTED_MODULE_1__[\"MAP\"].CAR && !elem.agent && elem.is_valid) {\n                    file.cars.push({\n                        \"mx\": elem.mx,\n                        \"my\": elem.my,\n                        \"line\": elem.line\n                    });\n                }\n                else if (elem.mapId == _global__WEBPACK_IMPORTED_MODULE_1__[\"MAP\"].ROAD) {\n                    map[elem.my][elem.mx] = elem.arrow;\n                }\n            }\n        }\n        for (var e = 0; e < this.assets.length; e++) {\n            var elem = this.assets[e];\n            if (!elem.isremove) {\n                if (elem.type != \"car\") {\n                    if (!file[elem.type])\n                        file[elem.type] = [];\n                    file[elem.type].push({\n                        \"x\": elem.x,\n                        \"y\": elem.y\n                    });\n                }\n            }\n        }\n        file.map = map;\n        if (this.level.agent) {\n            file.agent = {\n                \"mx\": this.level.agent.core.mx,\n                \"my\": this.level.agent.core.my,\n                \"line\": this.level.agent.core.line,\n                \"motion\": {\n                    \"type\": \"BasicMotionEngine\",\n                    \"options\": {\n                        \"rotationStep\": 0.5,\n                        \"actions\": [\"UP\", \"LEFT\", \"RIGHT\", \"DOWN\", \"WAIT\"]\n                    }\n                }\n            };\n        }\n        console.log(file);\n        file = JSON.stringify(file, null, 4);\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"saveAs\"](file, file_name);\n    };\n    return AssetManger;\n}());\n\n\n\n//# sourceURL=webpack://metacar/./src/asset_manager.ts?");

/***/ }),

/***/ "./src/basic_motion_engine.ts":
/*!************************************!*\
  !*** ./src/basic_motion_engine.ts ***!
  \************************************/
/*! exports provided: BasicMotionEngine */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BasicMotionEngine\", function() { return BasicMotionEngine; });\n/* harmony import */ var _motion_engine__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./motion_engine */ \"./src/motion_engine.ts\");\n/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./global */ \"./src/global.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n\n\n\nvar BasicMotionEngine = (function (_super) {\n    __extends(BasicMotionEngine, _super);\n    function BasicMotionEngine(level, options) {\n        var _this = _super.call(this, level) || this;\n        _this.rotationStep = options.rotationStep;\n        _this.actions = options.actions;\n        return _this;\n    }\n    BasicMotionEngine.prototype.setUp = function (car, lidar) {\n        this.car = car;\n        this.lidar = lidar;\n        this.state = [];\n        for (var y = 0; y < lidar.pts; y++) {\n            var line = [];\n            for (var x = 0; x < lidar.pts; x++) {\n                line.push(_global__WEBPACK_IMPORTED_MODULE_1__[\"MAP\"].DEFAULT);\n            }\n            this.state.push(line);\n        }\n        this.setUpKeyboard();\n        this.car.v = 0;\n        this.detectInteractions();\n    };\n    BasicMotionEngine.prototype.setUpKeyboard = function () {\n        var _this = this;\n        var left = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](37);\n        var up = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](38);\n        var right = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](39);\n        var down = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](40);\n        if (this.actions.indexOf(\"LEFT\") != -1)\n            left.press = function () { _this.turnLeft(); };\n        if (this.actions.indexOf(\"RIGHT\") != -1)\n            right.press = function () { _this.turnRight(); };\n        if (this.actions.indexOf(\"UP\") != -1) {\n            up.press = function () { _this.moveForward(); };\n            up.release = function () {\n                _this.car.v = 0;\n            };\n        }\n        if (this.actions.indexOf(\"DOWN\") != -1) {\n            down.press = function () { _this.moveBackward(); };\n            down.release = function () {\n                _this.car.v = 0;\n            };\n        }\n    };\n    BasicMotionEngine.prototype.turnLeft = function () {\n        this.car.rotation -= this.rotationStep * Math.PI;\n        this.lidar.rotation = this.car.rotation;\n    };\n    BasicMotionEngine.prototype.turnRight = function () {\n        this.car.rotation += this.rotationStep * Math.PI;\n        this.lidar.rotation = this.car.rotation;\n    };\n    BasicMotionEngine.prototype.moveForward = function () {\n        this.car.v = 1;\n    };\n    BasicMotionEngine.prototype.moveBackward = function () {\n        this.car.v = -1;\n    };\n    BasicMotionEngine.prototype.actionStep = function (delta, action) {\n        if (this.actions[action] == \"LEFT\") {\n            this.turnLeft();\n        }\n        if (this.actions[action] == \"RIGHT\") {\n            this.turnRight();\n        }\n        if (this.actions[action] == \"UP\") {\n            this.moveForward();\n        }\n        if (this.actions[action] == \"DOWN\") {\n            this.moveBackward();\n        }\n        var _a = this.step(delta), agent_col = _a.agent_col, on_road = _a.on_road;\n        this.car.v = 0;\n        return { agent_col: agent_col, on_road: on_road };\n    };\n    BasicMotionEngine.prototype.actionSpace = function () {\n        return Array.apply(null, { length: this.actions.length }).map(Number.call, Number);\n    };\n    BasicMotionEngine.prototype.step = function (delta) {\n        this.car.x += this.car.v * Math.cos(this.car.rotation) * delta;\n        this.car.y += this.car.v * Math.sin(this.car.rotation) * delta;\n        this.car.mx = Math.floor(this.car.x / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        this.car.my = Math.floor(this.car.y / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        this.car.checkAndsetNewRoad();\n        this.lidar.x = this.car.x;\n        this.lidar.y = this.car.y;\n        this.lidar.rotation = this.car.rotation;\n        var _a = this.detectInteractions(), agent_col = _a.agent_col, on_road = _a.on_road;\n        if (agent_col.length > 0) {\n            this.car.v = 0;\n            this.car.vy = 0;\n        }\n        return { agent_col: agent_col, on_road: on_road };\n    };\n    return BasicMotionEngine;\n}(_motion_engine__WEBPACK_IMPORTED_MODULE_0__[\"MotionEngine\"]));\n\n\n\n//# sourceURL=webpack://metacar/./src/basic_motion_engine.ts?");

/***/ }),

/***/ "./src/bot_motion_engine.ts":
/*!**********************************!*\
  !*** ./src/bot_motion_engine.ts ***!
  \**********************************/
/*! exports provided: BotMotionEngine */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BotMotionEngine\", function() { return BotMotionEngine; });\n/* harmony import */ var _motion_engine__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./motion_engine */ \"./src/motion_engine.ts\");\n/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./global */ \"./src/global.ts\");\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n\n\nvar BotMotionEngine = (function (_super) {\n    __extends(BotMotionEngine, _super);\n    function BotMotionEngine(level) {\n        var _this = _super.call(this, level) || this;\n        _this.map = _this.level.getMap();\n        _this.mapSizeY = _this.map.length;\n        _this.mapSizeX = _this.map[0].length;\n        _this.rotationStep = 0.5;\n        _this.rotationToNextCase = {};\n        _this.rotationToNextCase[0] = { \"mx\": 1, \"my\": 0 };\n        _this.rotationToNextCase[0.5] = { \"mx\": 0, \"my\": 1 };\n        _this.rotationToNextCase[1.0] = { \"mx\": -1, \"my\": 0 };\n        _this.rotationToNextCase[1.5] = { \"mx\": 0, \"my\": -1 };\n        _this.rotationToNextCase[-0.5] = { \"mx\": 0, \"my\": -1 };\n        _this.rotationToNextCase[-1.0] = { \"mx\": -1, \"my\": 0 };\n        _this.rotationToNextCase[-1.5] = { \"mx\": 0, \"my\": 1 };\n        return _this;\n    }\n    BotMotionEngine.prototype.setUp = function (car, lidar) {\n        this.car = car;\n        this.lidar = lidar;\n        this.state = [];\n        for (var y = 0; y < lidar.pts; y++) {\n            var line = [];\n            for (var x = 0; x < lidar.pts; x++) {\n                line.push(_global__WEBPACK_IMPORTED_MODULE_1__[\"MAP\"].DEFAULT);\n            }\n            this.state.push(line);\n        }\n        this.car.v = 0;\n        this.detectInteractions();\n    };\n    BotMotionEngine.prototype.turnLeft = function () {\n        this.car.rotation -= this.rotationStep * Math.PI;\n        this.lidar.rotation = this.car.rotation;\n    };\n    BotMotionEngine.prototype.turnRight = function () {\n        this.car.rotation += this.rotationStep * Math.PI;\n        this.lidar.rotation = this.car.rotation;\n    };\n    BotMotionEngine.prototype.moveUp = function () {\n        this.car.v = 1;\n    };\n    BotMotionEngine.prototype.moveDown = function () {\n        this.car.v = -1;\n    };\n    BotMotionEngine.prototype.isRoad = function (nx, ny) {\n        if (ny < 0 || ny >= this.mapSizeY || nx < 0 || nx >= this.mapSizeX || this.map[ny][nx] == 0) {\n            return false;\n        }\n        return true;\n    };\n    BotMotionEngine.prototype.autoRotation = function () {\n        var right_dist = _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] + (_global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 3);\n        var left_dist = _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] - (_global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 3.5);\n        var same_dist = _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"];\n        if (this.car.next_road) {\n            var y_dist = Math.abs(((this.car.next_road.outroad.y + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2) - this.car.y) * this.car.next_road.outroad_np.my);\n            var x_dist = Math.abs(((this.car.next_road.outroad.x + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2) - this.car.x) * this.car.next_road.outroad_np.mx);\n            if (this.car.next_road.rotation_type == 0) {\n                if (y_dist < right_dist && x_dist < right_dist) {\n                    this.car.haveTurned = true;\n                    this.car.rotation = this.car.rotation += Math.PI / 2;\n                    this.car.rotation = this.car.rotation % (2 * Math.PI);\n                    this.car.next_road = undefined;\n                    return;\n                }\n            }\n            if (this.car.next_road.rotation_type == 1) {\n                if (y_dist < left_dist && x_dist < left_dist) {\n                    this.car.haveTurned = true;\n                    this.car.rotation = this.car.rotation -= Math.PI / 2;\n                    this.car.rotation = this.car.rotation % (2 * Math.PI);\n                    this.car.next_road = undefined;\n                    return;\n                }\n            }\n            if (this.car.next_road.rotation_type == 2) {\n                if (y_dist < same_dist && x_dist < same_dist) {\n                    this.car.haveTurned = true;\n                    this.car.rotation = this.car.rotation -= Math.PI;\n                    this.car.rotation = this.car.rotation % (2 * Math.PI);\n                    if (y_dist != 0 && this.car.x < this.car.next_road.outroad.x + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2) {\n                        this.car.x = this.car.next_road.outroad.x + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2 + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 4;\n                        this.car.y = this.car.next_road.outroad.y;\n                    }\n                    else if (y_dist != 0 && this.car.x > this.car.next_road.outroad.x + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2) {\n                        this.car.x = this.car.next_road.outroad.x + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] - _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2 - _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 4;\n                        this.car.y = this.car.next_road.outroad.y;\n                    }\n                    else if (x_dist != 0 && this.car.y < this.car.next_road.outroad.y + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2) {\n                        this.car.y = this.car.next_road.outroad.y + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2 + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 4;\n                        this.car.x = this.car.next_road.outroad.x;\n                    }\n                    else if (x_dist != 0 && this.car.y > this.car.next_road.outroad.y + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2) {\n                        this.car.y = this.car.next_road.outroad.y + _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] - _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 2 - _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] / 4;\n                        this.car.x = this.car.next_road.outroad.x;\n                    }\n                    this.car.next_road = undefined;\n                    return;\n                }\n            }\n        }\n        else {\n            var key = this.car.rotation / Math.PI;\n            var key_r = ((this.car.rotation / Math.PI) + 0.5) % 2;\n            var key_l = ((this.car.rotation / Math.PI) - 0.5) % 2;\n            var is_next_pos = this.rotationToNextCase[key];\n            var is_next_pos_r = this.rotationToNextCase[key_r];\n            var is_next_pos_l = this.rotationToNextCase[key_l];\n            var turn = false;\n            var nx = this.car.mx + is_next_pos.mx;\n            var ny = this.car.my + is_next_pos.my;\n            if (!this.isRoad(nx, ny)) {\n                turn = true;\n            }\n            else if (!this.car.haveTurned && !this.car.turnedRandom) {\n                this.car.turnedRandom = Math.random();\n            }\n            else if (!this.car.haveTurned && this.car.turnedRandom < 0.33 && this.isRoad(this.car.mx + is_next_pos_r.mx, this.car.my + is_next_pos_r.my)) {\n                turn = true;\n            }\n            else if (!this.car.haveTurned && this.car.turnedRandom > 0.66 && this.isRoad(this.car.mx + is_next_pos_l.mx, this.car.my + is_next_pos_l.my)) {\n                turn = true;\n            }\n            if (turn) {\n                var possibles_rotations = [(key + 0.5) % 2., (key - 0.5) % 2., null];\n                for (var p = 0; p < possibles_rotations.length; p++) {\n                    var next_pos = void 0;\n                    if (possibles_rotations[p] != null) {\n                        next_pos = this.rotationToNextCase[possibles_rotations[p]];\n                    }\n                    else {\n                        next_pos = { \"mx\": 0, \"my\": 0 };\n                    }\n                    var px = this.car.mx + next_pos.mx;\n                    var py = this.car.my + next_pos.my;\n                    if (this.isRoad(px, py)) {\n                        this.car.next_road = {\n                            \"outroad\": { y: ny * _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"], x: nx * _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"] },\n                            \"outroad_np\": is_next_pos,\n                            \"rotation_type\": p,\n                        };\n                        return;\n                    }\n                }\n            }\n        }\n    };\n    BotMotionEngine.prototype.step = function (delta) {\n        if (this.state.toString().indexOf(\",\" + _global__WEBPACK_IMPORTED_MODULE_1__[\"MAP\"].CAR.toString()) != -1) {\n            this.car.v = 0;\n        }\n        else {\n            this.car.v = 0.8;\n            this.autoRotation();\n        }\n        this.car.x += this.car.v * Math.cos(this.car.rotation) * delta;\n        this.car.y += this.car.v * Math.sin(this.car.rotation) * delta;\n        this.car.mx = Math.floor(this.car.x / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        this.car.my = Math.floor(this.car.y / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        this.car.checkAndsetNewRoad();\n        this.lidar.x = this.car.x;\n        this.lidar.y = this.car.y;\n        this.lidar.rotation = this.car.rotation;\n        var _a = this.detectInteractions(), agent_col = _a.agent_col, on_road = _a.on_road;\n        if (agent_col.length > 0) {\n            this.car.v = 0;\n        }\n        return { agent_col: agent_col, on_road: on_road };\n    };\n    return BotMotionEngine;\n}(_motion_engine__WEBPACK_IMPORTED_MODULE_0__[\"MotionEngine\"]));\n\n\n\n//# sourceURL=webpack://metacar/./src/bot_motion_engine.ts?");

/***/ }),

/***/ "./src/car.ts":
/*!********************!*\
  !*** ./src/car.ts ***!
  \********************/
/*! exports provided: Car */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Car\", function() { return Car; });\n/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./global */ \"./src/global.ts\");\n\nvar Global_carId = 0;\nvar Car = (function () {\n    function Car(level, info, textures, options) {\n        if (options === void 0) { options = {}; }\n        var _this = this;\n        this.level = level;\n        options.image = options.image || _global__WEBPACK_IMPORTED_MODULE_0__[\"CAR_IMG\"].DEFAULT;\n        options.lidar = options.lidar || false;\n        options.lidarInfo = options.lidarInfo || { pts: 5, width: 4, height: 5, pos: 0 };\n        this.core = new _global__WEBPACK_IMPORTED_MODULE_0__[\"Sprite\"](textures[options.image]);\n        this.info = info;\n        this.core.scale.x = 0.8;\n        this.core.scale.y = 0.8;\n        this.core.anchor.x = 0.5;\n        this.core.anchor.y = 0.5;\n        this.core.road = undefined;\n        this.core.carId = Global_carId;\n        Global_carId += 1;\n        this.core.agent = false;\n        this.core.obstacle = true;\n        this.core.mapId = _global__WEBPACK_IMPORTED_MODULE_0__[\"MAP\"].CAR;\n        if (options.lidar) {\n            this.createLidar(options.lidarInfo);\n            this.core.lidar = this.lidar;\n        }\n        if (options.motionEngine) {\n            this.motion = options.motionEngine;\n            this.motion.setUp(this.core, this.lidar);\n            this.core.rotationStep = 0.5;\n        }\n        else {\n            this.core.rotationStep = 0.5;\n        }\n        this.core.mx = this.info.mx;\n        this.core.my = this.info.my;\n        this.core.x = (this.info.mx) * _global__WEBPACK_IMPORTED_MODULE_0__[\"ROADSIZE\"];\n        this.core.y = (this.info.my) * _global__WEBPACK_IMPORTED_MODULE_0__[\"ROADSIZE\"];\n        this.core.checkAndsetNewRoad = function (road) { return _this.checkAndsetNewRoad(road); };\n        var road = this.level.getRoad(this.core.my, this.core.mx);\n        this.core.line = 0;\n        if (road) {\n            road.setCarPosition(this.core, this.info.line);\n        }\n    }\n    Car.prototype.checkAndsetNewRoad = function (n_road) {\n        var current_road = this.core.road;\n        if (!n_road) {\n            n_road = this.level.getRoad(this.core.my, this.core.mx);\n            ;\n        }\n        if (n_road != current_road) {\n            if (current_road) {\n                current_road.cars.splice(current_road.cars.indexOf(this.core.carId), 1);\n            }\n            this.core.road = n_road;\n            this.core.haveTurned = false;\n            this.turnedRandom = undefined;\n            if (n_road)\n                n_road.cars.push(this.core.carId);\n        }\n    };\n    Car.prototype.reset = function () {\n        this.core.mx = this.info.mx;\n        this.core.my = this.info.my;\n        var road = this.level.getRoad(this.core.my, this.core.mx);\n        if (road) {\n            road.setCarPosition(this.core, this.info.line);\n        }\n    };\n    Car.prototype.getState = function () {\n        return this.motion.state.map(function (arr) { return arr.slice(); });\n    };\n    Car.prototype.step = function (delta, action) {\n        if (action === void 0) { action = null; }\n        if (action == null) {\n            var _a = this.motion.step(delta), agent_col = _a.agent_col, on_road = _a.on_road;\n        }\n        else {\n            var _b = this.motion.actionStep(delta, action), agent_col = _b.agent_col, on_road = _b.on_road;\n        }\n        return { agent_col: agent_col, on_road: on_road };\n    };\n    Car.prototype.createLidar = function (lidarOptions) {\n        this.lidar = new _global__WEBPACK_IMPORTED_MODULE_0__[\"Container\"]();\n        var area = new _global__WEBPACK_IMPORTED_MODULE_0__[\"Graphics\"]();\n        area.pt = false;\n        area.alpha = 0.5;\n        area.beginFill(0x515151);\n        area.drawRect(0, 0, this.core.width * lidarOptions.width, this.core.height * lidarOptions.height);\n        area.endFill();\n        var x_step = area.width / lidarOptions.pts;\n        var y_step = area.height / lidarOptions.pts;\n        for (var xs = lidarOptions.pts - 1; xs >= 0; xs--) {\n            for (var ys = 0; ys < lidarOptions.pts; ys++) {\n                var x = (x_step / 4) + xs * x_step;\n                var y = (y_step / 4) + ys * y_step;\n                var pt = new _global__WEBPACK_IMPORTED_MODULE_0__[\"Graphics\"]();\n                pt.pt = true;\n                pt.beginFill(0xffffff);\n                pt.drawRect(x, y, 5, 5);\n                pt.endFill();\n                this.lidar.addChild(pt);\n            }\n        }\n        this.lidar.pts = lidarOptions.pts;\n        this.lidar.addChild(area);\n        this.lidar.x = this.core.x;\n        this.lidar.y = this.core.y;\n        this.lidar.pivot.y = this.lidar.height / 2;\n        this.lidar.pivot.x = this.core.width / 2 - (lidarOptions.pos * this.core.width);\n        this.lidar.rotation = this.core.rotation;\n    };\n    return Car;\n}());\n\n\n\n//# sourceURL=webpack://metacar/./src/car.ts?");

/***/ }),

/***/ "./src/control_motion_engine.ts":
/*!**************************************!*\
  !*** ./src/control_motion_engine.ts ***!
  \**************************************/
/*! exports provided: ControlMotionEngine */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ControlMotionEngine\", function() { return ControlMotionEngine; });\n/* harmony import */ var _motion_engine__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./motion_engine */ \"./src/motion_engine.ts\");\n/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./global */ \"./src/global.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n\n\n\nvar ControlMotionEngine = (function (_super) {\n    __extends(ControlMotionEngine, _super);\n    function ControlMotionEngine(level) {\n        var _this = _super.call(this, level) || this;\n        _this.level = level;\n        _this.actions = [\"SteeringAngle\", \"Throttle\"];\n        return _this;\n    }\n    ControlMotionEngine.prototype.setUp = function (car, lidar) {\n        this.car = car;\n        this.lidar = lidar;\n        this.state = [];\n        for (var y = 0; y < lidar.pts; y++) {\n            var line = [];\n            for (var x = 0; x < lidar.pts; x++) {\n                line.push(_global__WEBPACK_IMPORTED_MODULE_1__[\"MAP\"].DEFAULT);\n            }\n            this.state.push(line);\n        }\n        this.setUpKeyboard();\n        this.car.v = 0;\n        this.car.a = 0;\n        this.car.yaw_rate = 0;\n        this.detectInteractions();\n    };\n    ControlMotionEngine.prototype.setUpKeyboard = function () {\n        var _this = this;\n        var left = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](37);\n        var up = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](38);\n        var right = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](39);\n        var down = _utils__WEBPACK_IMPORTED_MODULE_2__[\"keyboard\"](40);\n        left.press = function () {\n            _this.turn(-0.5);\n        };\n        left.release = function () {\n            _this.turn(0);\n        };\n        right.press = function () {\n            _this.turn(0.5);\n        };\n        right.release = function () {\n            _this.turn(0);\n        };\n        up.press = function () { _this.move(1); };\n        up.release = function () {\n            _this.car.a = 0;\n        };\n        down.press = function () { _this.move(-1); };\n        down.release = function () {\n            _this.car.a = 0;\n        };\n    };\n    ControlMotionEngine.prototype.turn = function (value) {\n        this.car.yaw_rate = value;\n    };\n    ControlMotionEngine.prototype.move = function (throttle) {\n        this.car.a = throttle;\n    };\n    ControlMotionEngine.prototype.actionStep = function (delta, actions) {\n        this.car.a = Math.min(Math.max(parseInt(actions[0].toString()), -1), 1);\n        this.car.yaw_rate = Math.min(Math.max(parseInt(actions[1].toString()), -1), 1);\n        var _a = this.step(delta), agent_col = _a.agent_col, on_road = _a.on_road;\n        this.car.a = 0;\n        this.car.yaw_rate = 0;\n        return { agent_col: agent_col, on_road: on_road };\n    };\n    ControlMotionEngine.prototype.actionSpace = function () {\n        return Array.apply(null, { length: this.actions.length }).map(Number.call, Number);\n    };\n    ControlMotionEngine.prototype.step = function (delta) {\n        if (this.car.v > 0)\n            this.car.v = Math.max(0, this.car.v - 0.01);\n        else if (this.car.v < 0)\n            this.car.v = Math.min(0, this.car.v + 0.01);\n        if (this.car.a > 0)\n            this.car.v = Math.min(2., this.car.v + this.car.a * 0.02);\n        else\n            this.car.v = Math.max(-2., this.car.v + this.car.a * 0.02);\n        if (this.car.yaw_rate == 0) {\n            this.car.x += this.car.v * Math.cos(this.car.rotation) * delta;\n            this.car.y += this.car.v * Math.sin(this.car.rotation) * delta;\n        }\n        else {\n            var yr = this.car.yaw_rate * 0.01 * (this.car.v + 0.001) * Math.PI;\n            this.car.x += (this.car.v / yr) * (Math.sin(this.car.rotation + (yr * delta)) - Math.sin(this.car.rotation));\n            this.car.y += (this.car.v / yr) * (Math.cos(this.car.rotation) - Math.cos(this.car.rotation + (yr * delta)));\n            this.car.rotation += yr * delta;\n        }\n        this.car.mx = Math.floor(this.car.x / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        this.car.my = Math.floor(this.car.y / _global__WEBPACK_IMPORTED_MODULE_1__[\"ROADSIZE\"]);\n        this.car.checkAndsetNewRoad();\n        this.lidar.x = this.car.x;\n        this.lidar.y = this.car.y;\n        this.lidar.rotation = this.car.rotation;\n        var _a = this.detectInteractions(), agent_col = _a.agent_col, on_road = _a.on_road;\n        if (agent_col.length > 0) {\n            this.car.v = 0;\n            this.car.vy = 0;\n        }\n        return { agent_col: agent_col, on_road: on_road };\n    };\n    return ControlMotionEngine;\n}(_motion_engine__WEBPACK_IMPORTED_MODULE_0__[\"MotionEngine\"]));\n\n\n\n//# sourceURL=webpack://metacar/./src/control_motion_engine.ts?");

/***/ }),

/***/ "./src/embedded.ts":
/*!*************************!*\
  !*** ./src/embedded.ts ***!
  \*************************/
/*! exports provided: embeddedUrl, embeddedContent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"embeddedUrl\", function() { return embeddedUrl; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"embeddedContent\", function() { return embeddedContent; });\n/* harmony import */ var _embedded_level_full_city__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./embedded/level/full_city */ \"./src/embedded/level/full_city.ts\");\n/* harmony import */ var _embedded_level_level_1__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./embedded/level/level_1 */ \"./src/embedded/level/level_1.ts\");\n\n\nvar embeddedUrl = {\n    fullCity: \"embedded://level/fullCity\",\n    level1: \"embedded://level/level1\"\n};\nvar embeddedContent = {\n    level: {\n        fullCity: _embedded_level_full_city__WEBPACK_IMPORTED_MODULE_0__[\"fullCity\"],\n        level1: _embedded_level_level_1__WEBPACK_IMPORTED_MODULE_1__[\"level1\"]\n    }\n};\n\n\n//# sourceURL=webpack://metacar/./src/embedded.ts?");

/***/ }),

/***/ "./src/embedded/level/full_city.ts":
/*!*****************************************!*\
  !*** ./src/embedded/level/full_city.ts ***!
  \*****************************************/
/*! exports provided: fullCity */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"fullCity\", function() { return fullCity; });\nvar fullCity = {\n    \"cars\": [\n        {\n            \"mx\": 2,\n            \"my\": 5,\n            \"line\": 0,\n            \"auto\": true\n        },\n        {\n            \"mx\": 3,\n            \"my\": 4,\n            \"line\": 0,\n            \"auto\": true\n        },\n        {\n            \"mx\": 3,\n            \"my\": 4,\n            \"line\": 1,\n            \"auto\": true\n        },\n        {\n            \"mx\": 6,\n            \"my\": 3,\n            \"line\": 0,\n            \"auto\": true\n        },\n        {\n            \"mx\": 6,\n            \"my\": 3,\n            \"line\": 1,\n            \"auto\": true\n        },\n        {\n            \"mx\": 8,\n            \"my\": 2,\n            \"line\": 0,\n            \"auto\": true\n        },\n        {\n            \"mx\": 8,\n            \"my\": 2,\n            \"line\": 1,\n            \"auto\": true\n        },\n        {\n            \"mx\": 2,\n            \"my\": 7,\n            \"line\": 0,\n            \"auto\": true\n        }\n    ],\n    \"house\": [\n        {\n            \"x\": 9,\n            \"y\": 409\n        },\n        {\n            \"x\": 146,\n            \"y\": 162\n        },\n        {\n            \"x\": 439,\n            \"y\": 39\n        }\n    ],\n    \"house2\": [\n        {\n            \"x\": 425,\n            \"y\": 192\n        },\n        {\n            \"x\": 431,\n            \"y\": 354\n        }\n    ],\n    \"house3\": [\n        {\n            \"x\": 426,\n            \"y\": 281\n        },\n        {\n            \"x\": 51,\n            \"y\": 157\n        },\n        {\n            \"x\": 553,\n            \"y\": 34\n        }\n    ],\n    \"bench\": [\n        {\n            \"x\": 259,\n            \"y\": 206\n        },\n        {\n            \"x\": 8,\n            \"y\": 205\n        }\n    ],\n    \"tree\": [\n        {\n            \"x\": 1,\n            \"y\": 303\n        },\n        {\n            \"x\": 54,\n            \"y\": 357\n        },\n        {\n            \"x\": 215,\n            \"y\": 325\n        },\n        {\n            \"x\": 230,\n            \"y\": 400\n        },\n        {\n            \"x\": 282,\n            \"y\": 368\n        },\n        {\n            \"x\": 182,\n            \"y\": 433\n        },\n        {\n            \"x\": 285,\n            \"y\": 309\n        },\n        {\n            \"x\": 576,\n            \"y\": 233\n        },\n        {\n            \"x\": 581,\n            \"y\": 300\n        },\n        {\n            \"x\": 519,\n            \"y\": 388\n        },\n        {\n            \"x\": 582,\n            \"y\": 391\n        },\n        {\n            \"x\": 256,\n            \"y\": 69\n        },\n        {\n            \"x\": 151,\n            \"y\": 43\n        },\n        {\n            \"x\": 77,\n            \"y\": 77\n        },\n        {\n            \"x\": 26,\n            \"y\": 24\n        },\n        {\n            \"x\": 189,\n            \"y\": 98\n        }\n    ],\n    \"map\": [\n        [\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            \"↕\",\n            0,\n            0,\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            \"↠\",\n            0,\n            0,\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            \"↦\",\n            \"↔\",\n            \"↔\",\n            \"↟\",\n            \"↔\"\n        ],\n        [\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            \"↕\",\n            0,\n            0,\n            0,\n            0\n        ],\n        [\n            \"↔\",\n            \"↔\",\n            \"↧\",\n            \"↔\",\n            \"↠\",\n            \"↔\",\n            \"↤\",\n            0,\n            0,\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            \"↕\",\n            0,\n            0,\n            0,\n            \"↕\",\n            0,\n            0,\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            \"↠\",\n            0,\n            0,\n            0,\n            \"↠\",\n            0,\n            0,\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            \"↕\",\n            0,\n            0,\n            0,\n            \"↕\",\n            0,\n            0,\n            0,\n            0\n        ]\n    ]\n};\n\n\n//# sourceURL=webpack://metacar/./src/embedded/level/full_city.ts?");

/***/ }),

/***/ "./src/embedded/level/level_1.ts":
/*!***************************************!*\
  !*** ./src/embedded/level/level_1.ts ***!
  \***************************************/
/*! exports provided: level1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"level1\", function() { return level1; });\nvar level1 = {\n    \"cars\": [\n        {\n            \"mx\": 5,\n            \"my\": 3,\n            \"line\": 0,\n            \"auto\": true\n        },\n        {\n            \"mx\": 5,\n            \"my\": 3,\n            \"line\": 1,\n            \"auto\": true\n        },\n        {\n            \"mx\": 5,\n            \"my\": 1,\n            \"line\": 0,\n            \"auto\": true\n        }\n    ],\n    \"tree\": [\n        {\n            \"x\": 120,\n            \"y\": 50\n        },\n        {\n            \"x\": 86.5,\n            \"y\": 85\n        },\n        {\n            \"x\": 94.5,\n            \"y\": 135\n        },\n        {\n            \"x\": 30.5,\n            \"y\": 128\n        },\n        {\n            \"x\": 72.5,\n            \"y\": 190\n        },\n        {\n            \"x\": 23.5,\n            \"y\": 232\n        },\n        {\n            \"x\": 110.5,\n            \"y\": 242\n        },\n        {\n            \"x\": 43.5,\n            \"y\": 33\n        },\n        {\n            \"x\": 18.5,\n            \"y\": 178\n        },\n        {\n            \"x\": 305.5,\n            \"y\": 125\n        },\n        {\n            \"x\": 360.5,\n            \"y\": 122\n        }\n    ],\n    \"asset\": [\n        {\n            \"x\": 252.5,\n            \"y\": 142\n        },\n        {\n            \"x\": 86.5,\n            \"y\": 85\n        },\n        {\n            \"x\": 94.5,\n            \"y\": 135\n        },\n        {\n            \"x\": 30.5,\n            \"y\": 128\n        },\n        {\n            \"x\": 252.5,\n            \"y\": 26\n        },\n        {\n            \"x\": 195.5,\n            \"y\": 0\n        },\n        {\n            \"x\": 307.5,\n            \"y\": 1\n        },\n        {\n            \"x\": 72.5,\n            \"y\": 190\n        },\n        {\n            \"x\": 23.5,\n            \"y\": 232\n        },\n        {\n            \"x\": 110.5,\n            \"y\": 242\n        },\n        {\n            \"x\": 43.5,\n            \"y\": 33\n        },\n        {\n            \"x\": 35.5,\n            \"y\": 185\n        },\n        {\n            \"x\": 18.5,\n            \"y\": 178\n        },\n        {\n            \"x\": 289.5,\n            \"y\": 126\n        },\n        {\n            \"x\": 337.5,\n            \"y\": 126\n        },\n        {\n            \"x\": 305.5,\n            \"y\": 125\n        },\n        {\n            \"x\": 360.5,\n            \"y\": 122\n        },\n        {\n            \"x\": 492.5,\n            \"y\": 56\n        },\n        {\n            \"x\": 503.5,\n            \"y\": 136\n        },\n        {\n            \"x\": 504.5,\n            \"y\": 58\n        }\n    ],\n    \"bench\": [\n        {\n            \"x\": 252.5,\n            \"y\": 142\n        },\n        {\n            \"x\": 252.5,\n            \"y\": 26\n        }\n    ],\n    \"road\": [\n        {\n            \"x\": 240,\n            \"y\": 60\n        },\n        {\n            \"x\": 240,\n            \"y\": 60\n        },\n        {\n            \"x\": 480,\n            \"y\": 0\n        },\n        {\n            \"x\": 480,\n            \"y\": 60\n        },\n        {\n            \"x\": 480,\n            \"y\": 120\n        },\n        {\n            \"x\": 480,\n            \"y\": 180\n        },\n        {\n            \"x\": 480,\n            \"y\": 240\n        },\n        {\n            \"x\": 300,\n            \"y\": 180\n        },\n        {\n            \"x\": 300,\n            \"y\": 180\n        },\n        {\n            \"x\": 360,\n            \"y\": 180\n        },\n        {\n            \"x\": 420,\n            \"y\": 180\n        },\n        {\n            \"x\": 420,\n            \"y\": 120\n        },\n        {\n            \"x\": 420,\n            \"y\": 60\n        },\n        {\n            \"x\": 360,\n            \"y\": 60\n        },\n        {\n            \"x\": 300,\n            \"y\": 60\n        },\n        {\n            \"x\": 420,\n            \"y\": 120\n        }\n    ],\n    \"house3\": [\n        {\n            \"x\": 503.5,\n            \"y\": 136\n        }\n    ],\n    \"house\": [\n        {\n            \"x\": 504.5,\n            \"y\": 58\n        }\n    ],\n    \"map\": [\n        [\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            0,\n            \"↱\",\n            \"↠\",\n            \"↔\",\n            \"↔\",\n            \"↰\",\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            0,\n            \"↕\",\n            0,\n            0,\n            0,\n            \"↟\",\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            0,\n            \"↳\",\n            \"↔\",\n            \"↔\",\n            \"↔\",\n            \"↲\",\n            0,\n            0\n        ],\n        [\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0,\n            0\n        ]\n    ],\n    \"agent\": {\n        \"mx\": 4,\n        \"my\": 3,\n        \"line\": 0,\n        \"motion\": {\n            \"type\": \"BasicMotionEngine\",\n            \"options\": {\n                \"rotationStep\": 0.5,\n                \"actions\": [\n                    \"UP\",\n                    \"LEFT\",\n                    \"RIGHT\"\n                ]\n            }\n        }\n    }\n};\n\n\n//# sourceURL=webpack://metacar/./src/embedded/level/level_1.ts?");

/***/ }),

/***/ "./src/global.ts":
/*!***********************!*\
  !*** ./src/global.ts ***!
  \***********************/
/*! exports provided: Application, Loader, Resources, Sprite, Graphics, Container, JSON_TEXTURES, LEVEL_FOLDER, ROADSIZE, CAR_IMG, MAP, ASSETS */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Application\", function() { return Application; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Loader\", function() { return Loader; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Resources\", function() { return Resources; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Sprite\", function() { return Sprite; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Graphics\", function() { return Graphics; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Container\", function() { return Container; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"JSON_TEXTURES\", function() { return JSON_TEXTURES; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LEVEL_FOLDER\", function() { return LEVEL_FOLDER; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ROADSIZE\", function() { return ROADSIZE; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CAR_IMG\", function() { return CAR_IMG; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MAP\", function() { return MAP; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ASSETS\", function() { return ASSETS; });\n/* harmony import */ var pixi_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pixi.js */ \"pixi.js\");\n/* harmony import */ var pixi_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(pixi_js__WEBPACK_IMPORTED_MODULE_0__);\n\nvar Application = pixi_js__WEBPACK_IMPORTED_MODULE_0__[\"Application\"];\nvar Loader = pixi_js__WEBPACK_IMPORTED_MODULE_0__[\"loader\"];\nvar Resources = pixi_js__WEBPACK_IMPORTED_MODULE_0__[\"loader\"].resources;\nvar Sprite = pixi_js__WEBPACK_IMPORTED_MODULE_0__[\"Sprite\"];\nvar Graphics = pixi_js__WEBPACK_IMPORTED_MODULE_0__[\"Graphics\"];\nvar Container = pixi_js__WEBPACK_IMPORTED_MODULE_0__[\"Container\"];\nvar JSON_TEXTURES = \"public/textures/textures.json\";\nvar LEVEL_FOLDER = \"/level/\";\nvar ROADSIZE = 60;\nvar CAR_IMG = {\n    DEFAULT: \"car.png\",\n    AGENT: \"car_agent.png\"\n};\nvar MAP = {\n    ROAD: -1,\n    DEFAULT: 0,\n    CAR: 1,\n    AGENT: 1,\n};\nvar ASSETS = {\n    ROADS: {\n        \"↕\": {\n            \"image\": \"road_u.png\",\n            \"orientation\": 1.5\n        },\n        \"↔\": {\n            \"image\": \"road_r.png\",\n            \"orientation\": 0.\n        },\n        \"↱\": {\n            \"image\": \"road_rotate_ld.png\",\n            \"orientation\": 1.25\n        },\n        \"↰\": {\n            \"image\": \"road_rotate_ul.png\",\n            \"orientation\": 0.75\n        },\n        \"↲\": {\n            \"image\": \"road_rotate_rl.png\",\n            \"orientation\": 0.25\n        },\n        \"↳\": {\n            \"image\": \"road_rotate_dl.png\",\n            \"orientation\": 1.75\n        },\n        \"↟\": {\n            \"image\": \"road_up.png\",\n            \"orientation\": 1.5\n        },\n        \"↠\": {\n            \"image\": \"road_rp.png\",\n            \"orientation\": 0.\n        },\n        \"↤\": {\n            \"image\": \"road_r2.png\",\n            \"orientation\": 0.\n        },\n        \"↦\": {\n            \"image\": \"road_l2.png\",\n            \"orientation\": 1.\n        },\n        \"↥\": {\n            \"image\": \"road_d2.png\",\n            \"orientation\": 0.5\n        },\n        \"↧\": {\n            \"image\": \"road_u2.png\",\n            \"orientation\": 1.5\n        },\n    },\n    \"house\": {\n        \"image\": \"house.png\"\n    },\n    \"house2\": {\n        \"image\": \"house2.png\"\n    },\n    \"house3\": {\n        \"image\": \"house3.png\"\n    },\n    \"bench\": {\n        \"image\": \"bench.png\"\n    },\n    \"tree\": {\n        \"image\": \"tree.png\"\n    }\n};\n\n\n//# sourceURL=webpack://metacar/./src/global.ts?");

/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _metacar__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./metacar */ \"./src/metacar.ts\");\n/* harmony import */ var _embedded__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./embedded */ \"./src/embedded.ts\");\n\n\nvar metacar = {\n    env: _metacar__WEBPACK_IMPORTED_MODULE_0__[\"MetaCar\"],\n    level: _embedded__WEBPACK_IMPORTED_MODULE_1__[\"embeddedUrl\"]\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (metacar);\n\n\n//# sourceURL=webpack://metacar/./src/index.ts?");

/***/ }),

/***/ "./src/level.ts":
/*!**********************!*\
  !*** ./src/level.ts ***!
  \**********************/
/*! exports provided: Level */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Level\", function() { return Level; });\n/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./global */ \"./src/global.ts\");\n/* harmony import */ var _asset_manager__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./asset_manager */ \"./src/asset_manager.ts\");\n\n\nvar Level = (function () {\n    function Level(levelContent, canvasId) {\n        this.app = null;\n        this.info = null;\n        this.envs = [];\n        this.map = null;\n        this.agent = null;\n        this.roads = {};\n        this.cars = [];\n        this.info = levelContent;\n        this.map = this.info.map;\n        this.canvasId = canvasId;\n        this.am = new _asset_manager__WEBPACK_IMPORTED_MODULE_1__[\"AssetManger\"](this);\n    }\n    Level.prototype.load = function (loop) {\n        var _this = this;\n        this.loop = loop;\n        return new Promise(function (resolve, reject) {\n            _this.createLevel(_this.info).then(function () { return resolve(); });\n        });\n    };\n    Level.prototype.render = function (val) {\n        if (val) {\n            this.app.ticker.start();\n        }\n        else {\n            this.app.ticker.stop();\n        }\n    };\n    Level.prototype.createLevel = function (info) {\n        var _this = this;\n        this.app = new PIXI.Application({\n            width: this.map[0].length * _global__WEBPACK_IMPORTED_MODULE_0__[\"ROADSIZE\"],\n            height: this.map.length * _global__WEBPACK_IMPORTED_MODULE_0__[\"ROADSIZE\"],\n            backgroundColor: 0x80bf3e\n        });\n        document.getElementById(this.canvasId).appendChild(this.app.view);\n        return new Promise(function (resolve, reject) {\n            _global__WEBPACK_IMPORTED_MODULE_0__[\"Loader\"].add([\"public/textures/textures.json\", \"public/textures/textures.png\"]).load(function () {\n                _this.setup(info);\n                resolve();\n            });\n        });\n    };\n    Level.prototype.setup = function (info) {\n        var _this = this;\n        var textures = _global__WEBPACK_IMPORTED_MODULE_0__[\"Loader\"].resources[_global__WEBPACK_IMPORTED_MODULE_0__[\"JSON_TEXTURES\"]].textures;\n        this.am.createMap(this.map, info, textures);\n        this.am.createCars(this.map, info, textures);\n        if (info.agent)\n            this.agent = this.am.createAgent(this.map, info, textures);\n        this.app.ticker.add(function (delta) { return _this.loop(delta); });\n    };\n    Level.prototype.reset = function () {\n        this.agent.reset();\n    };\n    Level.prototype.setReward = function (agent_col, on_road, action) {\n        var reward = -0.1;\n        if (action == 0 || this.agent.core.vx == 1)\n            reward += 0.5;\n        if (agent_col.length > 0) {\n            reward = -10;\n        }\n        else if (!on_road) {\n            reward = -10;\n        }\n        return reward;\n    };\n    Level.prototype.step = function (delta, action) {\n        if (action === void 0) { action = null; }\n        for (var c = 0; c < this.cars.length; c++) {\n            if (this.cars[c].lidar && !this.cars[c].core.agent)\n                this.cars[c].step(delta);\n        }\n        if (this.agent) {\n            var _a = this.agent.step(delta, action), agent_col = _a.agent_col, on_road = _a.on_road;\n            var reward = this.setReward(agent_col, on_road, action);\n            return reward;\n        }\n        return 0;\n    };\n    Level.prototype.stopRender = function () {\n        this.app.ticker.stop();\n    };\n    Level.prototype.addChild = function (child) {\n        this.app.stage.addChild(child);\n    };\n    Level.prototype.addRoad = function (road) {\n        this.roads[[road.my.toString(), road.mx.toString()].toString()] = road;\n        this.envs.push(road);\n        this.app.stage.addChild(road);\n    };\n    Level.prototype.addCar = function (car) {\n        this.cars.push(car);\n        this.app.stage.addChild(car.core);\n        this.envs.push(car.core);\n    };\n    Level.prototype.getRoad = function (my, mx) {\n        return this.roads[[my.toString(), mx.toString()].toString()];\n    };\n    Level.prototype.getRoads = function () {\n        return this.roads;\n    };\n    Level.prototype.findCarById = function (id) {\n        return this.cars.find(function (e) { return e.car_id == id; });\n    };\n    Level.prototype.getEnvs = function () {\n        return this.envs;\n    };\n    Level.prototype.getMap = function () {\n        return this.map;\n    };\n    return Level;\n}());\n\n\n\n//# sourceURL=webpack://metacar/./src/level.ts?");

/***/ }),

/***/ "./src/metacar.ts":
/*!************************!*\
  !*** ./src/metacar.ts ***!
  \************************/
/*! exports provided: MetaCar */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MetaCar\", function() { return MetaCar; });\n/* harmony import */ var _level__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./level */ \"./src/level.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n\n\nvar MetaCar = (function () {\n    function MetaCar(canvasId, levelUrl) {\n        var _this = this;\n        this.eventList = [\"train\", \"play\", \"stop\", \"reset_env\", \"reset_agent\", \"save\", \"load\"];\n        if (!canvasId || this.levelUrl) {\n            console.error(\"You must specify the canvasId and the levelUrl\");\n        }\n        this.isPlaying = false;\n        this.canvasId = canvasId;\n        this.levelUrl = levelUrl;\n        this.eventCallback = [\n            function (fc) { return _this.onTrain(fc); },\n            function (fc) { return _this.onPlay(fc); },\n            function (fc) { return _this.onStop(fc); },\n            function (fc) { return _this.onResetEnv(fc); },\n            function (fc) { return _this.onResetAgent(fc); },\n            function (fc) { return _this.onSave(fc); },\n            function (fc, opt) { return _this.onLoad(fc, opt); }\n        ];\n        var canvas = document.getElementById(canvasId);\n        var buttons = document.createElement('div');\n        buttons.classList.add(\"metacar_buttons_container\");\n        buttons.id = \"metacar_\" + canvasId + \"_buttons_container\";\n        canvas.parentNode.insertBefore(buttons, canvas.nextSibling);\n        this.buttonsContainer = buttons;\n    }\n    MetaCar.prototype.load = function (level, agent) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _utils__WEBPACK_IMPORTED_MODULE_1__[\"loadCustomURL\"](_this.levelUrl, function (content) {\n                _this.level = new _level__WEBPACK_IMPORTED_MODULE_0__[\"Level\"](content, _this.canvasId);\n                _this.level.load(function (delta) { return _this.loop(delta); });\n                resolve();\n            });\n        });\n    };\n    MetaCar.prototype._createButton = function (parent, name) {\n        var button = document.createElement('button');\n        button.classList.add(\"metacar_button_train\");\n        button.id = \"metacar_\" + this.canvasId + \"_button_\" + name;\n        name = name.replace(/_/g, \" \");\n        button.innerHTML = name.charAt(0).toUpperCase() + name.slice(1);\n        ;\n        parent.appendChild(button);\n        return button;\n    };\n    MetaCar.prototype.onTrain = function (fc) {\n        var _this = this;\n        var button = this._createButton(this.buttonsContainer, \"train\");\n        button.addEventListener(\"click\", function () {\n            _this.render(false);\n            if (fc)\n                fc();\n        });\n    };\n    MetaCar.prototype.onPlay = function (fc) {\n        var button = this._createButton(this.buttonsContainer, \"play\");\n        button.addEventListener(\"click\", function () {\n            if (fc)\n                fc();\n        });\n    };\n    MetaCar.prototype.onStop = function (fc) {\n        var button = this._createButton(this.buttonsContainer, \"stop\");\n        button.addEventListener(\"click\", function () {\n            if (fc)\n                fc();\n        });\n    };\n    MetaCar.prototype.onResetEnv = function (fc) {\n        var button = this._createButton(this.buttonsContainer, \"reset_env\");\n        button.addEventListener(\"click\", function () {\n            if (fc)\n                fc();\n        });\n    };\n    MetaCar.prototype.onResetAgent = function (fc) {\n        var button = this._createButton(this.buttonsContainer, \"reset_agent\");\n        button.addEventListener(\"click\", function () {\n            if (fc)\n                fc();\n        });\n    };\n    MetaCar.prototype.onSave = function (fc) {\n        var button = this._createButton(this.buttonsContainer, \"save\");\n        button.addEventListener(\"click\", function () {\n            if (fc)\n                fc();\n        });\n    };\n    MetaCar.prototype.onLoad = function (fc, options) {\n        var button = this._createButton(this.buttonsContainer, \"load_trained_agent\");\n        var input_file = document.createElement('input');\n        input_file.type = \"file\";\n        input_file.accept = \"*/*\";\n        input_file.style.display = \"none\";\n        input_file.classList.add(\"metacar_button_input_file\");\n        input_file.id = \"metacar_\" + this.canvasId + \"_button_input_file\";\n        this.buttonsContainer.appendChild(input_file);\n        input_file.addEventListener(\"change\", function (dump) {\n            console.log(\"New file to handle\");\n            _utils__WEBPACK_IMPORTED_MODULE_1__[\"readDump\"](dump, function (content) {\n                if (fc)\n                    fc(content);\n            });\n        });\n        button.addEventListener(\"click\", function () {\n            input_file.click();\n        });\n    };\n    MetaCar.prototype.addEvent = function (eventName, fc, options) {\n        var index = this.eventList.indexOf(eventName);\n        if (index == -1) {\n            console.error(\"The environement does not support this event. Only the following are\\\n            avaible:\" + this.eventList);\n        }\n        var event = this.eventList[index];\n        if (event != \"load\") {\n            this.eventCallback[index](fc);\n        }\n        else {\n            this.eventCallback[index](fc, options);\n        }\n    };\n    MetaCar.prototype.render = function (val) {\n        this.level.render(val);\n    };\n    MetaCar.prototype.save = function (content, file_name) {\n        _utils__WEBPACK_IMPORTED_MODULE_1__[\"saveAs\"](content, file_name);\n    };\n    MetaCar.prototype.actionSpace = function () {\n        return this.level.agent.motion.actionSpace();\n    };\n    MetaCar.prototype.getState = function () {\n        return this.level.agent.getState();\n    };\n    MetaCar.prototype.step = function (action) {\n        return this.level.step(1, action);\n    };\n    MetaCar.prototype.reset = function () {\n        this.level.reset();\n    };\n    MetaCar.prototype.randomRoadPosition = function () {\n        this.level.agent.last_position = [];\n        var roads = this.level.getRoads();\n        var keys = Object.keys(roads);\n        keys.sort(function () { return Math.random() - 0.5; });\n        for (var k in keys) {\n            var road = roads[keys[k]];\n            if (road.cars.length == 0) {\n                road.setCarPosition(this.level.agent.core);\n                break;\n            }\n        }\n    };\n    MetaCar.prototype.loop = function (delta) {\n        if (this.isPlaying) {\n            this.agent.play(this);\n        }\n        else {\n            this.level.step(delta);\n        }\n    };\n    return MetaCar;\n}());\n\n\n\n//# sourceURL=webpack://metacar/./src/metacar.ts?");

/***/ }),

/***/ "./src/motion_engine.ts":
/*!******************************!*\
  !*** ./src/motion_engine.ts ***!
  \******************************/
/*! exports provided: MotionEngine */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MotionEngine\", function() { return MotionEngine; });\n/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./global */ \"./src/global.ts\");\n\nvar MotionEngine = (function () {\n    function MotionEngine(level) {\n        this.level = level;\n    }\n    MotionEngine.prototype.boxesIntersect = function (a, b) {\n        var ab = a.getBounds();\n        var bb = b.getBounds();\n        return ab.x + ab.width > bb.x && ab.x < bb.x + bb.width && ab.y + ab.height > bb.y && ab.y < bb.y + bb.height;\n    };\n    MotionEngine.prototype.detectInteractions = function () {\n        var envs = this.level.getEnvs();\n        var agent_col = [];\n        var lidar_collisions = [];\n        var on_road = false;\n        for (var i = 0; i < envs.length; i++) {\n            if (envs[i] != this.car && envs[i].obstacle && this.boxesIntersect(envs[i], this.car)) {\n                agent_col.push(envs[i]);\n            }\n            else if (envs[i].mapId == _global__WEBPACK_IMPORTED_MODULE_0__[\"MAP\"].ROAD && this.boxesIntersect(envs[i], this.car)) {\n                on_road = true;\n            }\n            if (this.boxesIntersect(envs[i], this.lidar)) {\n                lidar_collisions.push(envs[i]);\n            }\n        }\n        this.setState(lidar_collisions);\n        return { agent_col: agent_col, on_road: on_road };\n    };\n    MotionEngine.prototype.setState = function (lidar_collisions) {\n        var pt_id = 0;\n        for (var i = 0; i < this.lidar.children.length; i++) {\n            this.lidar.children[i].alpha = 0.1;\n            if (this.lidar.children[i].pt) {\n                var pt_y = Math.floor(pt_id / this.lidar.pts);\n                var pt_x = Math.floor(pt_id % this.lidar.pts);\n                this.state[pt_y][pt_x] = _global__WEBPACK_IMPORTED_MODULE_0__[\"MAP\"].DEFAULT;\n                for (var a = 0; a < lidar_collisions.length; a++) {\n                    if (lidar_collisions[a] != this.car) {\n                        var touch = this.boxesIntersect(lidar_collisions[a], this.lidar.children[i]);\n                        if (touch && lidar_collisions[a].obstacle) {\n                            this.lidar.children[i].alpha = 1.;\n                        }\n                        if (touch && (lidar_collisions[a].mapId > this.state[pt_y][pt_x] || (lidar_collisions[a].mapId == _global__WEBPACK_IMPORTED_MODULE_0__[\"MAP\"].ROAD && this.state[pt_y][pt_x] == _global__WEBPACK_IMPORTED_MODULE_0__[\"MAP\"].DEFAULT))) {\n                            this.state[pt_y][pt_x] = lidar_collisions[a].mapId;\n                        }\n                    }\n                }\n                pt_id += 1;\n            }\n        }\n    };\n    return MotionEngine;\n}());\n\n;\n\n\n//# sourceURL=webpack://metacar/./src/motion_engine.ts?");

/***/ }),

/***/ "./src/utils.ts":
/*!**********************!*\
  !*** ./src/utils.ts ***!
  \**********************/
/*! exports provided: loadJSON, loadEmbeddedURL, loadLocalStorageURL, loadCustomURL, mod, argMax, mean, saveAs, readDump, shuffleArray, keyboard */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadJSON\", function() { return loadJSON; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadEmbeddedURL\", function() { return loadEmbeddedURL; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadLocalStorageURL\", function() { return loadLocalStorageURL; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadCustomURL\", function() { return loadCustomURL; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"mod\", function() { return mod; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"argMax\", function() { return argMax; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"mean\", function() { return mean; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"saveAs\", function() { return saveAs; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"readDump\", function() { return readDump; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"shuffleArray\", function() { return shuffleArray; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"keyboard\", function() { return keyboard; });\n/* harmony import */ var _embedded__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./embedded */ \"./src/embedded.ts\");\n\nfunction loadJSON(url, callback) {\n    var xobj = new XMLHttpRequest();\n    xobj.overrideMimeType(\"application/json\");\n    xobj.open('GET', url, true);\n    xobj.onreadystatechange = function () {\n        if (xobj.readyState == 4 && xobj.status == 200) {\n            callback(xobj.responseText);\n        }\n    };\n    xobj.send(null);\n}\nfunction loadEmbeddedURL(url, callback) {\n    var split = url.split(\"//\");\n    split = split[1].split(\"/\");\n    callback(_embedded__WEBPACK_IMPORTED_MODULE_0__[\"embeddedContent\"][split[0]][split[1]]);\n}\nfunction loadLocalStorageURL(url, callback) {\n}\nfunction loadCustomURL(url, callback) {\n    var customCall = {\n        \"embedded:\": loadEmbeddedURL,\n        \"http://\": loadJSON,\n        \"https://\": loadJSON,\n        \"localstorage://\": loadLocalStorageURL\n    };\n    var split = url.split(\"//\");\n    customCall[split[0]](url, callback);\n}\nfunction mod(n, m) {\n    return ((n % m) + m) % m;\n}\nfunction argMax(array) {\n    if (array.every(function (v) { return v == -Infinity; })) {\n        return Math.floor(Math.random() * array.length);\n    }\n    return array.map(function (x, i) { return [x, i]; }).reduce(function (r, a) { return (a[0] > r[0] ? a : r); })[1];\n}\nfunction mean(array) {\n    if (array.length == 0)\n        return null;\n    var sum = array.reduce(function (a, b) { return a + b; });\n    var avg = sum / array.length;\n    return avg;\n}\nfunction saveAs(content, name) {\n    var a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    var blob = new Blob([content], { type: 'application/octet-binary' }), tmpURL = window.URL.createObjectURL(blob);\n    a.href = tmpURL;\n    a.download = name;\n    a.click();\n    window.URL.revokeObjectURL(tmpURL);\n    a.href = \"\";\n}\nfunction readDump(dump, callback) {\n    var input = dump.target;\n    var file = input.files[0];\n    var reader = new FileReader();\n    reader.readAsText(file, \"UTF-8\");\n    reader.onload = function (evt) {\n        callback(evt.target.result);\n    };\n}\nfunction shuffleArray(array) {\n    for (var i = array.length - 1; i > 0; i--) {\n        var j = Math.floor(Math.random() * (i + 1));\n        var temp = array[i];\n        array[i] = array[j];\n        array[j] = temp;\n    }\n    return array;\n}\nfunction keyboard(keyCode) {\n    var key = {};\n    key.code = keyCode;\n    key.isDown = false;\n    key.isUp = true;\n    key.press = undefined;\n    key.release = undefined;\n    key.downHandler = function (event) {\n        if (event.keyCode === key.code) {\n            if (key.isUp && key.press)\n                key.press();\n            key.isDown = true;\n            key.isUp = false;\n        }\n    };\n    key.upHandler = function (event) {\n        if (event.keyCode === key.code) {\n            if (key.isDown && key.release)\n                key.release();\n            key.isDown = false;\n            key.isUp = true;\n        }\n    };\n    window.addEventListener(\"keydown\", key.downHandler.bind(key), false);\n    window.addEventListener(\"keyup\", key.upHandler.bind(key), false);\n    return key;\n}\n\n\n//# sourceURL=webpack://metacar/./src/utils.ts?");

/***/ }),

/***/ "pixi.js":
/*!***********************!*\
  !*** external "PIXI" ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("(function() { module.exports = window[\"PIXI\"]; }());\n\n//# sourceURL=webpack://metacar/external_%22PIXI%22?");

/***/ })

/******/ })["default"];